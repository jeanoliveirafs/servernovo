<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>👻 Phantom Identity System</title>
    
    <!-- PWA Meta Tags -->
    <meta name="description" content="Sistema avançado de mascaramento de identidade digital com links compartilhados">
    <meta name="theme-color" content="#16213e">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="PhantomID">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="msapplication-TileColor" content="#1a1a2e">
    <meta name="msapplication-tap-highlight" content="no">
    
    <!-- Manifest -->
    <link rel="manifest" href="manifest.json">
    
    <!-- Icons -->
    <link rel="apple-touch-icon" href="icons/icon-192x192.png">
    <link rel="apple-touch-icon" sizes="152x152" href="icons/icon-152x152.png">
    <link rel="apple-touch-icon" sizes="192x192" href="icons/icon-192x192.png">
    <link rel="apple-touch-icon" sizes="512x512" href="icons/icon-512x512.png">
    
    <!-- Scripts -->
    <script src="https://cdn.socket.io/4.7.2/socket.io.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- CSS -->
    <link rel="stylesheet" href="style.css">
    <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>👻</text></svg>">
</head>
<body class="bg-gray-900 text-white min-h-screen">
    <div class="container mx-auto px-4 py-8">
        <header class="mb-8 text-center">
            <div class="flex justify-center items-center mb-4">
                <div class="text-6xl mr-4">👻</div>
                <div>
                    <h1 class="text-4xl font-bold text-blue-400 mb-2">
                        Phantom Identity Control Center
                    </h1>
                    <p class="text-gray-400">Sistema de Sincronização de Identidade Digital</p>
                </div>
            </div>
            <div id="connection-status" class="inline-flex items-center px-3 py-1 rounded-full text-sm font-medium bg-red-900 text-red-300">
                <div class="w-2 h-2 bg-red-500 rounded-full mr-2 animate-pulse"></div>
                Desconectado
            </div>
        </header>

        <div class="grid grid-cols-1 lg:grid-cols-3 gap-6 mb-8">
            <!-- Status Panel -->
            <div class="bg-gray-800 rounded-lg p-6 border border-gray-700 hover:border-gray-600 transition-colors">
                <h2 class="text-xl font-semibold mb-4 text-green-400 flex items-center">
                    <span class="text-2xl mr-2">📊</span>
                    Status do Sistema
                </h2>
                <div id="system-status" class="space-y-3">
                    <div class="flex justify-between">
                        <span class="text-gray-400">Servidor:</span>
                        <span id="server-status" class="text-green-400">● Online</span>
                    </div>
                    <div class="flex justify-between">
                        <span class="text-gray-400">Clientes:</span>
                        <span id="client-count" class="text-blue-400">0</span>
                    </div>
                    <div class="flex justify-between">
                        <span class="text-gray-400">Uptime:</span>
                        <span id="uptime" class="text-yellow-400">0s</span>
                    </div>
                    <div class="flex justify-between">
                        <span class="text-gray-400">Proxies:</span>
                        <span id="proxy-count" class="text-purple-400">0/0</span>
                    </div>
                </div>
            </div>

            <!-- Connected Clients -->
            <div class="bg-gray-800 rounded-lg p-6 border border-gray-700 hover:border-gray-600 transition-colors">
                <h2 class="text-xl font-semibold mb-4 text-blue-400 flex items-center">
                    <span class="text-2xl mr-2">👥</span>
                    Clientes Conectados
                </h2>
                <div id="clients-list" class="space-y-2 max-h-32 overflow-y-auto">
                    <p class="text-gray-400 text-sm">Nenhum cliente conectado</p>
                </div>
            </div>

            <!-- Phantom Identity Config -->
            <div class="bg-gray-800 rounded-lg p-6 border border-gray-700 hover:border-gray-600 transition-colors">
                <h2 class="text-xl font-semibold mb-4 text-purple-400 flex items-center">
                    <span class="text-2xl mr-2">🎭</span>
                    Identidade Phantom
                </h2>
                <div id="identity-info" class="text-sm space-y-2">
                    <div class="flex justify-between">
                        <span class="text-gray-400">ID:</span>
                        <span id="phantom-id" class="text-purple-300">Carregando...</span>
                    </div>
                    <div class="flex justify-between">
                        <span class="text-gray-400">Proxy IP:</span>
                        <span id="proxy-ip" class="text-green-300">Carregando...</span>
                    </div>
                    <div>
                        <span class="text-gray-400">User Agent:</span>
                        <p id="user-agent" class="text-xs text-gray-300 mt-1 break-words">Carregando...</p>
                    </div>
                    <div class="flex justify-between">
                        <span class="text-gray-400">Timezone:</span>
                        <span id="timezone" class="text-blue-300">Carregando...</span>
                    </div>
                    <div class="flex justify-between">
                        <span class="text-gray-400">Idiomas:</span>
                        <span id="languages" class="text-yellow-300">Carregando...</span>
                    </div>
                </div>
            </div>
        </div>

        <!-- Controls -->
        <div class="bg-gray-800 rounded-lg p-6 border border-gray-700 mb-8">
            <h2 class="text-xl font-semibold mb-4 text-yellow-400 flex items-center">
                <span class="text-2xl mr-2">🔧</span>
                Controles
            </h2>
            <div class="grid grid-cols-1 md:grid-cols-3 lg:grid-cols-5 gap-4">
                <button id="sync-all" class="bg-blue-600 hover:bg-blue-700 px-4 py-2 rounded transition duration-200 flex items-center justify-center">
                    <span class="mr-2">🔄</span>
                    Sincronizar Todos
                </button>
                <button id="test-fingerprint" class="bg-green-600 hover:bg-green-700 px-4 py-2 rounded transition duration-200 flex items-center justify-center">
                    <span class="mr-2">🧪</span>
                    Testar Fingerprint
                </button>
                <button id="generate-identity" class="bg-purple-600 hover:bg-purple-700 px-4 py-2 rounded transition duration-200 flex items-center justify-center">
                    <span class="mr-2">🎲</span>
                    Nova Identidade
                </button>
                <button id="test-proxy" class="bg-orange-600 hover:bg-orange-700 px-4 py-2 rounded transition duration-200 flex items-center justify-center">
                    <span class="mr-2">🌐</span>
                    Testar Proxy
                </button>
                <button id="clear-logs" class="bg-red-600 hover:bg-red-700 px-4 py-2 rounded transition duration-200 flex items-center justify-center">
                    <span class="mr-2">🗑️</span>
                    Limpar Logs
                </button>
            </div>
        </div>

        <!-- Shared Links System -->
        <div class="bg-gray-800 rounded-lg p-6 border border-gray-700 mb-8">
            <h2 class="text-xl font-semibold mb-4 text-indigo-400 flex items-center">
                <span class="text-2xl mr-2">🔗</span>
                Links Compartilhados
                <span class="ml-2 text-xs bg-indigo-600 px-2 py-1 rounded">NOVO</span>
            </h2>
            <p class="text-gray-400 text-sm mb-4">
                Crie links que compartilham a mesma identidade e IP com outros usuários
            </p>
            
            <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                <!-- Gerar Link -->
                <div class="bg-gray-700 rounded-lg p-4">
                    <h3 class="text-lg font-medium text-indigo-300 mb-3">Gerar Novo Link</h3>
                    <div class="space-y-3">
                        <div>
                            <label class="block text-sm text-gray-400 mb-1">URL de Destino:</label>
                            <input 
                                type="url" 
                                id="target-url" 
                                placeholder="https://exemplo.com" 
                                class="w-full px-3 py-2 bg-gray-600 border border-gray-500 rounded text-white placeholder-gray-400 focus:border-indigo-500 focus:outline-none"
                            >
                        </div>
                        <div>
                            <label class="block text-sm text-gray-400 mb-1">Expiração:</label>
                            <select 
                                id="link-expiry" 
                                class="w-full px-3 py-2 bg-gray-600 border border-gray-500 rounded text-white focus:border-indigo-500 focus:outline-none"
                            >
                                <option value="1h">1 hora</option>
                                <option value="6h">6 horas</option>
                                <option value="24h" selected>24 horas</option>
                                <option value="7d">7 dias</option>
                                <option value="30d">30 dias</option>
                            </select>
                        </div>
                        <div class="flex items-center">
                            <input type="checkbox" id="allow-mobile" class="mr-2">
                            <label for="allow-mobile" class="text-sm text-gray-400">Otimizar para mobile</label>
                        </div>
                        <button 
                            id="generate-link" 
                            class="w-full bg-indigo-600 hover:bg-indigo-700 px-4 py-2 rounded transition duration-200 flex items-center justify-center"
                        >
                            <span class="mr-2">✨</span>
                            Gerar Link Compartilhado
                        </button>
                    </div>
                </div>

                <!-- Links Ativos -->
                <div class="bg-gray-700 rounded-lg p-4">
                    <h3 class="text-lg font-medium text-green-300 mb-3">Links Ativos</h3>
                    <div id="active-links" class="space-y-3 max-h-64 overflow-y-auto">
                        <p class="text-gray-400 text-sm">Nenhum link ativo</p>
                    </div>
                </div>
            </div>

            <!-- Link Gerado -->
            <div id="generated-link-section" class="mt-6 hidden">
                <div class="bg-green-900 border border-green-700 rounded-lg p-4">
                    <h3 class="text-lg font-medium text-green-300 mb-3 flex items-center">
                        <span class="mr-2">✅</span>
                        Link Gerado com Sucesso!
                    </h3>
                    <div class="bg-black rounded p-3 mb-3">
                        <div class="flex items-center justify-between">
                            <code id="generated-link-display" class="text-green-400 text-sm break-all"></code>
                            <button 
                                id="copy-link" 
                                class="ml-3 bg-green-600 hover:bg-green-700 px-3 py-1 rounded text-xs transition duration-200"
                            >
                                📋 Copiar
                            </button>
                        </div>
                    </div>
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-4 text-sm">
                        <div>
                            <span class="text-gray-400">ID do Link:</span>
                            <p id="link-id" class="text-green-300 font-mono text-xs"></p>
                        </div>
                        <div>
                            <span class="text-gray-400">IP Compartilhado:</span>
                            <p id="shared-ip" class="text-green-300"></p>
                        </div>
                        <div>
                            <span class="text-gray-400">Expira em:</span>
                            <p id="link-expires" class="text-green-300"></p>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Test Sites -->
        <div class="bg-gray-800 rounded-lg p-6 border border-gray-700 mb-8">
            <h2 class="text-xl font-semibold mb-4 text-red-400 flex items-center">
                <span class="text-2xl mr-2">🧪</span>
                Sites de Teste
            </h2>
            <div id="test-sites" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
                <!-- Sites serão carregados aqui -->
            </div>
        </div>

        <!-- Fingerprint Details -->
        <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-8">
            <div class="bg-gray-800 rounded-lg p-6 border border-gray-700">
                <h2 class="text-xl font-semibold mb-4 text-cyan-400 flex items-center">
                    <span class="text-2xl mr-2">🖥️</span>
                    Hardware Fingerprint
                </h2>
                <div id="hardware-info" class="text-sm space-y-2">
                    <div class="flex justify-between">
                        <span class="text-gray-400">CPU Cores:</span>
                        <span id="cpu-cores" class="text-cyan-300">-</span>
                    </div>
                    <div class="flex justify-between">
                        <span class="text-gray-400">Memória:</span>
                        <span id="memory-info" class="text-cyan-300">-</span>
                    </div>
                    <div class="flex justify-between">
                        <span class="text-gray-400">GPU:</span>
                        <span id="gpu-info" class="text-cyan-300 text-xs">-</span>
                    </div>
                    <div class="flex justify-between">
                        <span class="text-gray-400">Tela:</span>
                        <span id="screen-info" class="text-cyan-300">-</span>
                    </div>
                </div>
            </div>

            <div class="bg-gray-800 rounded-lg p-6 border border-gray-700">
                <h2 class="text-xl font-semibold mb-4 text-pink-400 flex items-center">
                    <span class="text-2xl mr-2">🌍</span>
                    Network & Location
                </h2>
                <div id="network-info" class="text-sm space-y-2">
                    <div class="flex justify-between">
                        <span class="text-gray-400">Localização:</span>
                        <span id="location-info" class="text-pink-300">-</span>
                    </div>
                    <div class="flex justify-between">
                        <span class="text-gray-400">Conexão:</span>
                        <span id="connection-info" class="text-pink-300">-</span>
                    </div>
                    <div class="flex justify-between">
                        <span class="text-gray-400">WebRTC IP:</span>
                        <span id="webrtc-ip" class="text-pink-300">-</span>
                    </div>
                    <div class="flex justify-between">
                        <span class="text-gray-400">DNS:</span>
                        <span id="dns-info" class="text-pink-300">-</span>
                    </div>
                </div>
            </div>
        </div>

        <!-- Logs -->
        <div class="bg-gray-800 rounded-lg p-6 border border-gray-700">
            <h2 class="text-xl font-semibold mb-4 text-gray-400 flex items-center">
                <span class="text-2xl mr-2">📝</span>
                Logs em Tempo Real
                <div class="ml-auto flex items-center">
                    <span class="text-sm text-gray-500 mr-4">Auto-scroll:</span>
                    <label class="switch">
                        <input type="checkbox" id="auto-scroll" checked>
                        <span class="slider"></span>
                    </label>
                </div>
            </h2>
            <div id="logs" class="bg-black rounded p-4 h-64 overflow-y-auto font-mono text-sm border-2 border-gray-700">
                <div class="text-green-400 log-entry">
                    <span class="timestamp">[00:00:00]</span>
                    <span class="log-type">[SYSTEM]</span>
                    <span class="log-message">Phantom Identity Control Center iniciado</span>
                </div>
            </div>
        </div>
    </div>

    <script src="app.js"></script>
    
    <!-- PWA Service Worker Registration -->
    <script>
        // Registrar Service Worker
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('/sw.js')
                    .then((registration) => {
                        console.log('🔧 Service Worker registrado:', registration.scope);
                        
                        // Verificar atualizações
                        registration.addEventListener('updatefound', () => {
                            const newWorker = registration.installing;
                            newWorker.addEventListener('statechange', () => {
                                if (newWorker.state === 'installed' && navigator.serviceWorker.controller) {
                                    // Nova versão disponível
                                    showUpdateNotification();
                                }
                            });
                        });
                    })
                    .catch((error) => {
                        console.error('❌ Erro ao registrar Service Worker:', error);
                    });
            });
        }

        // Mostrar notificação de atualização
        function showUpdateNotification() {
            if (confirm('Nova versão disponível! Deseja atualizar?')) {
                window.location.reload();
            }
        }

        // Verificar se é PWA
        function isPWA() {
            return window.matchMedia('(display-mode: standalone)').matches ||
                   window.navigator.standalone === true;
        }

        // Configurações PWA
        window.addEventListener('DOMContentLoaded', () => {
            // Adicionar classe PWA se estiver rodando como app
            if (isPWA()) {
                document.body.classList.add('pwa-mode');
                console.log('📱 Rodando como PWA');
            }

            // Prompt de instalação
            let deferredPrompt;
            window.addEventListener('beforeinstallprompt', (e) => {
                e.preventDefault();
                deferredPrompt = e;
                showInstallButton();
            });

            // Mostrar botão de instalação
            function showInstallButton() {
                const installButton = document.createElement('button');
                installButton.innerHTML = '📱 Instalar App';
                installButton.className = 'fixed bottom-4 right-4 bg-indigo-600 hover:bg-indigo-700 text-white px-4 py-2 rounded-lg shadow-lg transition-all duration-200 z-50';
                installButton.addEventListener('click', installPWA);
                document.body.appendChild(installButton);
            }

            // Instalar PWA
            function installPWA() {
                if (deferredPrompt) {
                    deferredPrompt.prompt();
                    deferredPrompt.userChoice.then((result) => {
                        if (result.outcome === 'accepted') {
                            console.log('✅ PWA instalado');
                        }
                        deferredPrompt = null;
                        // Remover botão
                        const installButton = document.querySelector('button');
                        if (installButton && installButton.textContent.includes('Instalar App')) {
                            installButton.remove();
                        }
                    });
                }
            }
        });
    </script>
</body>
</html>